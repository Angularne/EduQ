<hr>
<h2>Queue</h2>
<button *ngIf="teacherOrAssistent" class="btn btn-primary btn-md" (click)="toggleQueueButton()">Activate/Deactivate Queue</button>

<div *ngIf="queue?.active">
  <div class="btn-group btn-group-sm" *ngIf="!teacherOrAssistent">
    <button class="btn btn-primary btn-md"  *ngIf="!myUserInQueue" (click)="addQueueElement()" [disabled]="!_taskSelected">Queue</button>
    <button class="btn btn-primary btn-md" *ngIf="myUserInQueue" (click)="deleteFromQueue()">Remove me</button>
  </div>
  <br><br>
  <table class="table" *ngIf="!(myUserInQueue || teacherOrAssistent) " (change)="checkMyUserInQueue()">
    <tr>
      <td>
        <b>Users in subject</b>
      </td>
      <td>
        <b>Add friends</b>
      </td>
      <td>
        <b>Task</b>
      </td>
      <td>
        <b>Location</b>
      </td>
    </tr>
    <tr>
      <td>
        <!--
        TODO dont work on phone. should not use (click). select can use multiple?
        -->
        <div>
          <select size="5" class="form-control">
            <option *ngFor="#user of studentsNotInQueue" (click)="selectUser(user)" draggable="true">{{user.firstname}} {{user.lastname}}</option>
          </select>
        </div>
      </td>
      <td>
        <div>
          <select multiple size="5" class="form-control">
            <option *ngFor="#selectedUser of usersSelected" (click)="unselectUser(selectedUser)">{{selectedUser.firstname}} {{selectedUser.lastname}}</option>
          </select>
        </div>
      </td>
      <td>
        <div>
          <select size="5" class="form-control">
            <option *ngFor="#task of tasks" (click)="selectTask(task)">{{task.number}} - {{task.title}}</option>
          </select>
        </div>
      </td>
      <td>
        <form class="form-horizontal">
          <div class="form-group">
            <div class="col-sm-10">
              <p class="form-control-static">
                Roomnumber
              </p>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-10">
              <input size="3" type="text" id="inputRoomDescription" class="form-control" placeholder="Description...">
            </div>
          </div>
        </form>
      </td>
    </tr>

  </table>

  <table class="table table-hover">
    <tr>
      <td>
        <b>#</b>
      </td>
      <td>
        <b>Time</b>
      </td>
      <td>
        <b>Name</b>
      </td>
      <td>
        <b>Task</b>
      </td>
      <!-- TODO Authcheck for userRole -->

      <td>
        <b>Soon to come: Location!</b>
      </td>
      <td>

      </td>

    </tr>
    <tr *ngFor="#element of queue?.list; #i = index">
      <td>
        {{i+1}}
      </td>
      <td>{{element.timeEntered}} <span *ngIf="element.helper"> - Helper: {{element.helper.firstname}}</span></td>
      <td><span *ngFor="#user of element?.users; #i = index"> <span *ngIf="i != 0"> - </span>{{user.firstname}}</span> </td>
      <td>
        <span> {{element.task}}</span>

      </td>
      <td>
        Roomnumber<br> <!-- element.location.room -->
        Placement description <!-- element.location.description -->
      </td>
      <!-- TODO Check for auth or own user -->
      <td class="text-right">
        <div class="btn-group btn-group-sm" *ngIf="teacherOrAssistent">
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Action <span class="caret"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right">
            <li *ngIf="!element.helper"><a (click)="helpQueueElement(element)">Help</a></li>
            <li *ngIf="element.helper"><a (click)="acceptTask(element)">Accept</a></li>
            <li *ngIf="i +1 < queue.list.length"><a href="#" type="button" data-toggle="modal" data-target="#delayModal" (click)="onClickDelay(i, element)">Delay</a></li>

            <li><a href="#">Something else here</a></li>
            <li role="separator" class="divider"></li>
            <li><a (click)="removeQueueElement(element)">Remove group</a></li>
          </ul>
        </div>


        <button class="btn btn-danger btn-sm" *ngIf="checkIfMyUser(element)" (click)="removeQueueElement(element)">X</button>
      </td>
    </tr>
  </table>
</div>
<div *ngIf="!queue?.active">
  <h2>The queue is not active</h2>
</div>
<hr>
<div class="modal bs-example-modal-sm" tabindex="-1" role="dialog" id="delayModal" aria-labelledby="delayModalTitle">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="delayModalTitle">Delay</h4>
      </div>
      <div class="modal-body">
          <label for=""></label>
          <select class="form-control">
            <option *ngFor="#step of steppermax; #i = index" (select)="onDelaySelect(i)">{{i+1}} places</option>
          </select>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" (click)="onSubmitDelay()" class="btn btn-primary" data-dismiss="modal">Delay</button>
      </div>
    </div>
  </div>
</div>
